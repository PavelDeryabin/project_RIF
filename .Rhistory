legend.text = element_text(size = 13),
axis.text.x = element_text(size = 13),
axis.text.y = element_text(size = 13),
legend.position = 'right') +
scale_colour_brewer(palette = 'Set2')
seu.PRJNA1141235.fig3 <- readRDS('processed.data/seu.PRJNA1141235.fig3.Rds')
cells.order.random <- sample(Cells(seu.PRJNA1141235.fig3))
p3a <- DimPlot(seu.PRJNA1141235.fig3, reduction = "umap.harmony", group.by = "Phenotype",
label = FALSE, raster = FALSE, cells = cells.order.random) +
labs(title = '', x = 'UMAP Harmony 2', y = 'UMAP Harmony 1', color = 'Phenotype') +
theme_classic(base_size = 13) +
theme(plot.title = element_text(hjust = 0.5, size = 14),
legend.title = element_text(size = 13),
legend.text = element_text(size = 13),
axis.text.x = element_text(size = 13),
axis.text.y = element_text(size = 13),
legend.position = 'right') +
scale_colour_brewer(palette = 'Set2')
p3b <- DimPlot(seu.PRJNA1141235.fig3, reduction = "umap.harmony", group.by = "Menstrual.cycle.phase",
label = FALSE, raster = FALSE, cells = cells.order.random) +
labs(title = '', x = 'UMAP Harmony 2', y = 'UMAP Harmony 1', color = 'Histopathological\nmenstrual cycle\nphase assignment') +
theme_classic(base_size = 13) +
theme(plot.title = element_text(hjust = 0.5, size = 14),
legend.title = element_text(size = 13),
legend.text = element_text(size = 13),
axis.text.x = element_text(size = 13),
axis.text.y = element_text(size = 13),
legend.position = 'right') +
scale_colour_brewer(palette = 'Paired')
p3c <- DimPlot(seu.PRJNA1141235.fig3, reduction = "umap.harmony", group.by = "cell_type",
label = FALSE, raster = FALSE, cells = cells.order.random) +
labs(title = '', x = 'UMAP Harmony 2', y = 'UMAP Harmony 1', color = 'Cell type') +
theme_classic(base_size = 13) +
theme(plot.title = element_text(hjust = 0.5, size = 14),
legend.title = element_text(size = 13),
legend.text = element_text(size = 13),
axis.text.x = element_text(size = 13),
axis.text.y = element_text(size = 13),
legend.position = 'right')
marker.genes <- c(
'EMCN', 'VWF', # Endothelial
'EPCAM', 'CLDN3', # Epithelial
'CCL5', 'GZMA', # Lymphoid
'CD14', 'MNDA', # Myeliod
'COL1A1', 'DCN' # Stromal
)
marker.genes.df <- subset(features.ids, symbols %in% marker.genes)
rownames(marker.genes.df) <- marker.genes.df$symbols
marker.genes.df <- marker.genes.df[marker.genes, ]
p3d <- DotPlot(seu.PRJNA1141235.fig3, assay = "RNA", features = marker.genes.df$ensg, group.by = "cell_type",
dot.scale = 5, cluster.idents = FALSE) +
labs(title = "", x = "Marker genes", y = "Major cell type") +
theme_classic(base_size = 13) +
theme(plot.title = element_text(hjust = 0.5, size = 14),
legend.title = element_text(size = 13),
legend.text = element_text(size = 13),
axis.text.x = element_text(angle = 45, hjust = 1, size = 13),
axis.text.y = element_text(size = 13),
legend.position = 'right', # bottom
# legend.box = "", # horizontal
legend.margin = margin()) +
scale_x_discrete(labels = marker.genes) +
scale_y_discrete(limits = rev(levels(as.factor(seu.PRJNA1141235.fig3$cell_type)))) +
scale_color_distiller(type = "seq", direction = 1, palette = "Greys")
gedit_result.GSE111974 <- read.csv('processed.data/GSE111974.dcnv.results_CTPredictions.tsv', sep = '\t', header = T, row.names = 1)
gedit_result.GSE207362 <- read.csv('processed.data/GSE207362.dcnv.results_CTPredictions.tsv', sep = '\t', header = T, row.names = 1)
gedit_result.GSE243550 <- read.csv('processed.data/GSE243550.dcnv.results_CTPredictions.tsv', sep = '\t', header = T, row.names = 1)
gedit_result.GSE58144 <- read.csv('processed.data/GSE58144.dcnv.results_CTPredictions.tsv', sep = '\t', header = T, row.names = 1)
mdata.GSE111974 <- read.csv('processed.data/mdata.GSE111974.csv', sep = ',', header = T, row.names = 1)
mdata.GSE207362 <- read.csv('processed.data/mdata.GSE207362.csv', sep = ',', header = T, row.names = 1)
mdata.GSE243550 <- read.csv('processed.data/mdata.GSE243550.csv', sep = ',', header = T, row.names = 1)
mdata.GSE58144 <- read.csv('processed.data/mdata.GSE58144.csv', sep = ',', header = T, row.names = 1)
mdata.GSE111974 <- cbind(mdata.GSE111974, gedit_result.GSE111974)
mdata.GSE207362 <- cbind(mdata.GSE207362, gedit_result.GSE207362)
mdata.GSE243550 <- cbind(mdata.GSE243550, gedit_result.GSE243550)
mdata.GSE58144 <- cbind(mdata.GSE58144, gedit_result.GSE58144)
mdata.GSE111974.subset <- subset(mdata.GSE111974, EndEst > 31 & EndEst < 85)
mdata.GSE207362.subset <- subset(mdata.GSE207362, EndEst > 72 & EndEst < 83)
mdata.GSE243550.subset <- subset(mdata.GSE243550, EndEst > 66 & EndEst < 80)
mdata.GSE58144.subset <- subset(mdata.GSE58144, EndEst > 62 & EndEst < 74)
mdata.merged1 <- mdata.GSE111974.subset
mdata.merged.dcnv.plot.props1 <- mdata.merged1 %>% pivot_longer(cols = colnames(mdata.merged1)[c(12:16)], names_to = "cell_type", values_to = "Proportion")
p3e1 <- ggplot(mdata.merged.dcnv.plot.props1, aes(EndEst, Proportion, color = Phenotype, fill = Phenotype)) +
geom_smooth(method = lm, formula = y ~ splines::bs(x, 3), se = TRUE) +
geom_point(color = 'black', size = 3, shape = 21, alpha = 0.8) +
facet_rep_grid(GEO.accession ~ cell_type) +
labs(title = "", x = "EndEst", y = "Cell type proportion") +
theme_classic(base_size = 13) +
theme(plot.title = element_text(hjust = 0.5, size = 13, face = "italic"),
strip.background = element_blank(),
strip.text.y = element_text(size = 13),
strip.text.x = element_text(size = 13),
axis.text.x = element_text(size = 13),
axis.text.y = element_text(size = 13),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
legend.text = element_text(size = 13),
legend.title = element_text(size = 13),
legend.position = 'none',
panel.border = element_blank(),
axis.line = element_line()) +
scale_colour_brewer(palette = 'Set2') +
scale_fill_brewer(palette = 'Set2')
mdata.merged2 <- rbind(mdata.GSE207362.subset, mdata.GSE243550.subset, mdata.GSE58144.subset)
mdata.merged.dcnv.plot.props2 <- mdata.merged2 %>% pivot_longer(cols = colnames(mdata.merged2)[c(12:16)], names_to = "cell_type", values_to = "Proportion")
p3e2 <- ggplot(mdata.merged.dcnv.plot.props2, aes(EndEst, Proportion, color = Phenotype, fill = Phenotype)) +
geom_smooth(method = lm, formula = y ~ splines::bs(x, 3), se = TRUE) +
geom_point(color = 'black', size = 3, shape = 21, alpha = 0.8) +
facet_rep_grid(GEO.accession ~ cell_type, scales = 'free_y') +
labs(title = "", x = "EndEst", y = "Cell type proportion") +
theme_classic(base_size = 13) +
theme(plot.title = element_text(hjust = 0.5, size = 13, face = "italic"),
strip.background = element_blank(),
strip.text.y = element_text(size = 13),
strip.text.x = element_blank(),
axis.text.x = element_text(size = 13),
axis.text.y = element_text(size = 13),
legend.text = element_text(size = 13),
legend.title = element_text(size = 13),
legend.position = 'right',
panel.border = element_blank(),
axis.line = element_line()) +
scale_colour_brewer(palette = 'Set2') +
scale_fill_brewer(palette = 'Set2')
p3.line12 <- wrap_plots(p3a, p3b, p3c, p3d, ncol = 2)
p3.line3 <- wrap_plots(p3e1, p3e2, ncol = 1, heights = c(1.2, 4.2))
p3 <- wrap_plots(p3.line12, p3.line3, nrow = 2, heights = c(1, 1.5))
ggsave(plot = p3, filename = 'visualization/Figure 3.jpeg', width = 12, height = 15, dpi = 300)
p3d <- DotPlot(seu.PRJNA1141235.fig3, assay = "RNA", features = marker.genes.df$ensg, group.by = "cell_type",
dot.scale = 5, cluster.idents = FALSE) +
labs(title = "", x = "Marker genes", y = "Cell type") +
theme_classic(base_size = 13) +
theme(plot.title = element_text(hjust = 0.5, size = 14),
legend.title = element_text(size = 13),
legend.text = element_text(size = 13),
axis.text.x = element_text(angle = 45, hjust = 1, size = 13),
axis.text.y = element_text(size = 13),
legend.position = 'right', # bottom
# legend.box = "", # horizontal
legend.margin = margin()) +
scale_x_discrete(labels = marker.genes) +
scale_y_discrete(limits = rev(levels(as.factor(seu.PRJNA1141235.fig3$cell_type)))) +
scale_color_distiller(type = "seq", direction = 1, palette = "Greys")
p3.line12 <- wrap_plots(p3a, p3b, p3c, p3d, ncol = 2)
p3 <- wrap_plots(p3.line12, p3.line3, nrow = 2, heights = c(1, 1.5))
ggsave(plot = p3, filename = 'visualization/Figure 3.jpeg', width = 12, height = 15, dpi = 300)
seu.PRJNA1141235.fig4@meta.data <- seu.PRJNA1141235.fig4@meta.data %>% mutate(cell_type = case_when(
seurat_clusters %in% c('9', '12') ~ 'Myeloid',
seurat_clusters %in% c('2', '4', '8', '10', '11', '13') ~ 'Lymphoid',
seurat_clusters %in% c('6') ~ 'Endothelial',
seurat_clusters %in% c('3') ~ 'Epithelial',
seurat_clusters %in% c('0', '1', '5', '7') ~ 'Stromal'
))
DimPlot(seu.PRJNA1141235.fig4, reduction = "umap.harmony", group.by = "cell_type",
label = FALSE, raster = FALSE, cells = cells.order.random) +
labs(title = '', x = 'UMAP Harmony 2', y = 'UMAP Harmony 1', color = 'Cell type') +
theme_classic(base_size = 13) +
theme(plot.title = element_text(hjust = 0.5, size = 14),
legend.title = element_text(size = 13),
legend.text = element_text(size = 13),
axis.text.x = element_text(size = 13),
axis.text.y = element_text(size = 13),
legend.position = 'right')
seu.PRJNA1141235.fig4@meta.data <- seu.PRJNA1141235.fig4@meta.data %>% mutate(cell_type = case_when(
seurat_clusters %in% c('9', '12') ~ 'Myeloid',
seurat_clusters %in% c('2', '4', '8', '10', '11', '13') ~ 'Lymphoid',
seurat_clusters %in% c('6') ~ 'Endothelial',
seurat_clusters %in% c('3') ~ 'Epithelial',
seurat_clusters %in% c('0', '1', '5', '7') ~ 'Stromal'
))
DimPlot(seu.PRJNA1141235.fig4, reduction = "umap.harmony", group.by = "cell_type",
label = FALSE, raster = FALSE, cells = cells.order.random) +
labs(title = '', x = 'UMAP Harmony 2', y = 'UMAP Harmony 1', color = 'Cell type') +
theme_classic(base_size = 13) +
theme(plot.title = element_text(hjust = 0.5, size = 14),
legend.title = element_text(size = 13),
legend.text = element_text(size = 13),
axis.text.x = element_text(size = 13),
axis.text.y = element_text(size = 13),
legend.position = 'right')
cells.order.random <- sample(Cells(seu.PRJNA1141235.fig4))
DimPlot(seu.PRJNA1141235.fig4, reduction = "umap.harmony", group.by = "Phenotype",
label = FALSE, raster = FALSE, cells = cells.order.random) +
labs(title = '', x = 'UMAP Harmony 2', y = 'UMAP Harmony 1', color = 'Phenotype') +
theme_classic(base_size = 13) +
theme(plot.title = element_text(hjust = 0.5, size = 14),
legend.title = element_text(size = 13),
legend.text = element_text(size = 13),
axis.text.x = element_text(size = 13),
axis.text.y = element_text(size = 13),
legend.position = 'right') +
scale_colour_brewer(palette = 'Set2')
ps2a1 <- DimPlot(seu.PRJNA1141235.fig4, reduction = "umap.harmony", group.by = "Phenotype",
label = FALSE, raster = FALSE, cells = cells.order.random) +
labs(title = '', x = 'UMAP Harmony 2', y = 'UMAP Harmony 1', color = 'Phenotype') +
theme_classic(base_size = 13) +
theme(plot.title = element_text(hjust = 0.5, size = 14),
legend.title = element_text(size = 13),
legend.text = element_text(size = 13),
axis.text.x = element_text(size = 13),
axis.text.y = element_text(size = 13),
legend.position = 'right') +
scale_colour_brewer(palette = 'Set2')
ps2b1 <- DimPlot(seu.PRJNA1141235.fig4, reduction = "umap.harmony", group.by = "cell_type",
label = FALSE, raster = FALSE, cells = cells.order.random) +
labs(title = '', x = 'UMAP Harmony 2', y = 'UMAP Harmony 1', color = 'Cell type') +
theme_classic(base_size = 13) +
theme(plot.title = element_text(hjust = 0.5, size = 14),
legend.title = element_text(size = 13),
legend.text = element_text(size = 13),
axis.text.x = element_text(size = 13),
axis.text.y = element_text(size = 13),
legend.position = 'right')
DotPlot(seu.PRJNA1141235.fig4, assay = "RNA", features = marker.genes.df$ensg, group.by = "cell_type",
dot.scale = 5, cluster.idents = FALSE) +
labs(title = "", x = "", y = "") +
theme_classic(base_size = 13) +
theme(plot.title = element_text(hjust = 0.5, size = 14),
legend.title = element_text(size = 13),
legend.text = element_text(size = 13),
axis.text.x = element_text(angle = 45, hjust = 1, size = 13),
axis.text.y = element_text(size = 13),
legend.position = 'right', # bottom
# legend.box = "", # horizontal
legend.margin = margin()) +
scale_x_discrete(labels = marker.genes) +
scale_y_discrete(limits = rev(levels(as.factor(seu.PRJNA1141235.fig4$cell_type)))) +
scale_color_distiller(type = "seq", direction = 1, palette = "Greys")
ps2c1 <- DotPlot(seu.PRJNA1141235.fig4, assay = "RNA", features = marker.genes.df$ensg, group.by = "cell_type",
dot.scale = 5, cluster.idents = FALSE) +
labs(title = "", x = "", y = "") +
theme_classic(base_size = 13) +
theme(plot.title = element_text(hjust = 0.5, size = 14),
legend.title = element_text(size = 13),
legend.text = element_text(size = 13),
axis.text.x = element_text(angle = 45, hjust = 1, size = 13),
axis.text.y = element_text(size = 13),
legend.position = 'right', # bottom
# legend.box = "", # horizontal
legend.margin = margin()) +
scale_x_discrete(labels = marker.genes) +
scale_y_discrete(limits = rev(levels(as.factor(seu.PRJNA1141235.fig4$cell_type)))) +
scale_color_distiller(type = "seq", direction = 1, palette = "Greys")
saveRDS(seu.PRJNA1141235.fig4, file.path('processed.data/seu.PRJNA1141235.fig4.Rds'))
samples.files.names <- list.files(path = '/home/pd/datasets/hs_endometrium/sc_rna_seq/GSE250130.RIF/quants/', full.names = TRUE)
samples.seu.list <- lapply(samples.files.names, function(sample.name) {
sample.quant.mtx <- tximport(files = paste0(sample.name, '/alevin/quants_mat.gz'), type = 'alevin')
sample.seu <- CreateSeuratObject(sample.quant.mtx$counts, min.features = 300)
sample.seu$orig.ident <- gsub('^([^_]*).*', '\\1', gsub('\\..*', '', gsub('.*//', '', sample.name)))
return(sample.seu)
})
seu.GSE250130 <- merge(x = samples.seu.list[[1]], y = samples.seu.list[-1])
mdata.GSE250130 <- read.csv('/home/pd/datasets/hs_endometrium/sc_rna_seq/GSE250130.RIF/SraRunTable.csv',
header = T, sep = ',', row.names = 1)
mdata.GSE250130$names <- rownames(mdata.GSE250130)
mdata.GSE250130$GEO.accession <- 'GSE250130'
mdata.GSE250130$GSM.accession <- rownames(mdata.GSE250130)
mdata.GSE250130$Sample.name <- mdata.GSE250130$Sample.Name
mdata.GSE250130$Phenotype <- sub('.* ', '', sub('_.*', '', mdata.GSE250130$Library.Name))
mdata.GSE250130$Menstrual.cycle.time <- 'LH+7'
mdata.GSE250130$Menstrual.cycle.phase <- 'Secretory mid'
mdata.GSE250130$Age.years <- mdata.GSE250130$AGE
mdata.GSE250130 <- mdata.GSE250130[, c(35:42)]
mdata.GSE250130 <- mdata.GSE250130 %>%
mutate(Phenotype = case_when(
Phenotype == 'LH7' ~ 'Normal',
Phenotype == 'RIF' ~ 'RIF'))
seu.GSE250130.metadata <- merge(x = seu.GSE250130@meta.data, y = mdata.GSE250130, by.x = 'orig.ident', by.y = 'names', all.x = TRUE)
rownames(seu.GSE250130.metadata) <- rownames(seu.GSE250130@meta.data)
seu.GSE250130@meta.data <- seu.GSE250130.metadata
seu.GSE250130 <- JoinLayers(seu.GSE250130)
seu.GSE250130$percent.mt <- PercentageFeatureSet(seu.GSE250130, features = subset(features.ids, chr == 'chrM')$ensg)
Idents(seu.GSE250130) <- 'orig.ident'
seu.GSE250130 <- subset(seu.GSE250130, subset = nFeature_RNA > 300 & nFeature_RNA < 5000 & percent.mt < 20)
gc()
samples.seu.list <- SplitObject(seu.GSE250130, split.by = 'orig.ident')
gc()
for (i in 1:length(samples.seu.list)) {
sample.seu <- NormalizeData(samples.seu.list[[i]])
sample.seu <- FindVariableFeatures(sample.seu, selection.method = "vst", nfeatures = 2000)
sample.seu <- ScaleData(sample.seu)
sample.seu <- RunPCA(sample.seu, dims = 1:20)
sample.seu <- RunUMAP(sample.seu, dims = 1:20)
sample.seu <- FindNeighbors(object = sample.seu, dims = 1:20)
sample.seu <- FindClusters(object = sample.seu, resolution = 0.2)
sweep.res.list <- paramSweep(sample.seu, PCs = 1:20, sct = FALSE)
sweep.stats <- summarizeSweep(sweep.res.list, GT = FALSE)
bcmvn <- find.pK(sweep.stats)
pK <- bcmvn %>% filter(BCmetric == max(BCmetric)) %>% dplyr::select(pK)
pK <- as.numeric(as.character(pK[[1]]))
annotations <- sample.seu@meta.data$seurat_clusters
homotypic.prop <- modelHomotypic(annotations)
nExp_poi <- round(0.05 * nrow(sample.seu@meta.data))  ## Assuming 5% doublet formation rate
nExp_poi.adj <- round(nExp_poi * (1 - homotypic.prop))
sample.seu <- doubletFinder(sample.seu, PCs = 1:20, pN = 0.25, pK = pK, nExp = nExp_poi.adj, reuse.pANN = FALSE, sct = FALSE)
colnames(sample.seu@meta.data)[ncol(sample.seu@meta.data)] <- "DF_prediction"
samples.seu.list[[i]] <- sample.seu
remove(sample.seu)
}
seu.GSE250130.DF <- merge(x = samples.seu.list[[1]], y = samples.seu.list[-1])
samples.files.names <- list.files(path = '/home/pd/datasets/hs_endometrium/sc_rna_seq/GSE250130.RIF/quants/', full.names = TRUE)
samples.seu.list <- lapply(samples.files.names, function(sample.name) {
sample.quant.mtx <- tximport(files = paste0(sample.name, '/alevin/quants_mat.gz'), type = 'alevin')
sample.seu <- CreateSeuratObject(sample.quant.mtx$counts, min.features = 300)
sample.seu$orig.ident <- gsub('^([^_]*).*', '\\1', gsub('\\..*', '', gsub('.*//', '', sample.name)))
return(sample.seu)
})
seu.GSE250130 <- merge(x = samples.seu.list[[1]], y = samples.seu.list[-1])
mdata.GSE250130 <- read.csv('/home/pd/datasets/hs_endometrium/sc_rna_seq/GSE250130.RIF/SraRunTable.csv',
header = T, sep = ',', row.names = 1)
mdata.GSE250130$names <- rownames(mdata.GSE250130)
mdata.GSE250130$GEO.accession <- 'GSE250130'
mdata.GSE250130$GSM.accession <- rownames(mdata.GSE250130)
mdata.GSE250130$Sample.name <- mdata.GSE250130$Sample.Name
mdata.GSE250130$Phenotype <- sub('.* ', '', sub('_.*', '', mdata.GSE250130$Library.Name))
mdata.GSE250130$Menstrual.cycle.time <- 'LH+7'
mdata.GSE250130$Menstrual.cycle.phase <- 'Secretory mid'
mdata.GSE250130$Age.years <- mdata.GSE250130$AGE
mdata.GSE250130 <- mdata.GSE250130[, c(35:42)]
mdata.GSE250130 <- mdata.GSE250130 %>%
mutate(Phenotype = case_when(
Phenotype == 'LH7' ~ 'Normal',
Phenotype == 'RIF' ~ 'RIF'))
seu.GSE250130.metadata <- merge(x = seu.GSE250130@meta.data, y = mdata.GSE250130, by.x = 'orig.ident', by.y = 'names', all.x = TRUE)
rownames(seu.GSE250130.metadata) <- rownames(seu.GSE250130@meta.data)
seu.GSE250130@meta.data <- seu.GSE250130.metadata
seu.GSE250130 <- JoinLayers(seu.GSE250130)
seu.GSE250130$percent.mt <- PercentageFeatureSet(seu.GSE250130, features = subset(features.ids, chr == 'chrM')$ensg)
Idents(seu.GSE250130) <- 'orig.ident'
seu.GSE250130 <- subset(seu.GSE250130, subset = nFeature_RNA > 300 & nFeature_RNA < 5000 & percent.mt < 20)
seu.GSE250130$DF_prediction <- seu.GSE250130.DF$DF_prediction
seu.GSE250130 <- JoinLayers(seu.GSE250130)
seu.GSE250130 <- subset(seu.GSE250130, DF_prediction == 'Singlet')
saveRDS(seu.GSE250130, file.path('processed.data/seu.GSE250130.Rds'))
seu.GSE250130[["RNA"]] <- split(seu.GSE250130[["RNA"]], f = seu.GSE250130$orig.ident)
seu.GSE250130 <- NormalizeData(seu.GSE250130)
seu.GSE250130 <- FindVariableFeatures(seu.GSE250130, selection.method = "vst", nfeatures = 2000)
seu.GSE250130 <- ScaleData(seu.GSE250130)
seu.GSE250130 <- RunPCA(seu.GSE250130, npcs = 20)
seu.GSE250130 <- RunHarmony(seu.GSE250130, group.by.vars = c('orig.ident'), reduction.save = 'harmony')
seu.GSE250130 <- RunUMAP(seu.GSE250130, reduction = 'harmony', dims = 1:20, reduction.name = 'umap.harmony')
seu.GSE250130 <- FindNeighbors(seu.GSE250130, reduction = 'harmony', dims = 1:20)
seu.GSE250130 <- FindClusters(seu.GSE250130, resolution = 0.3)
cells.order.random <- sample(Cells(seu.GSE250130))
DimPlot(seu.GSE250130, reduction = "umap.harmony", group.by = "Phenotype",
label = FALSE, raster = FALSE, cells = cells.order.random, pt.size = 0.8) +
labs(title = '', x = 'UMAP Harmony 2', y = 'UMAP Harmony 1', color = 'Phenotype') +
theme_classic(base_size = 13) +
theme(plot.title = element_text(hjust = 0.5, size = 14),
legend.title = element_text(size = 13),
legend.text = element_text(size = 13),
axis.text.x = element_text(size = 13),
axis.text.y = element_text(size = 13),
legend.position = 'right') +
scale_colour_brewer(palette = 'Set2')
DimPlot(seu.GSE250130, reduction = "umap.harmony", group.by = "Phenotype",
label = FALSE, raster = FALSE, cells = cells.order.random) +
labs(title = '', x = 'UMAP Harmony 2', y = 'UMAP Harmony 1', color = 'Phenotype') +
theme_classic(base_size = 13) +
theme(plot.title = element_text(hjust = 0.5, size = 14),
legend.title = element_text(size = 13),
legend.text = element_text(size = 13),
axis.text.x = element_text(size = 13),
axis.text.y = element_text(size = 13),
legend.position = 'right') +
scale_colour_brewer(palette = 'Set2')
seu.GSE250130 <- JoinLayers(seu.GSE250130)
DimPlot(seu.GSE250130, reduction = "umap.harmony", group.by = "seurat_clusters", label = TRUE)
DotPlot(seu.GSE250130, assay = "RNA", features = marker.genes.df$ensg, group.by = "cell_type",
dot.scale = 5, cluster.idents = FALSE) +
labs(title = "", x = "", y = "") +
theme_classic(base_size = 13) +
theme(plot.title = element_text(hjust = 0.5, size = 14),
legend.title = element_text(size = 13),
legend.text = element_text(size = 13),
axis.text.x = element_text(angle = 45, hjust = 1, size = 13),
axis.text.y = element_text(size = 13),
legend.position = 'right', # bottom
# legend.box = "", # horizontal
legend.margin = margin()) +
scale_x_discrete(labels = marker.genes) +
scale_y_discrete(limits = rev(levels(as.factor(seu.GSE250130$cell_type)))) +
scale_color_distiller(type = "seq", direction = 1, palette = "Greys")
marker.genes <- c(
'EMCN', 'VWF', # Endothelial
'EPCAM', 'CLDN3', # Epithelial
'CCL5', 'GZMA', # Lymphoid
'CD14', 'MNDA', # Myeliod
'COL1A1', 'DCN' # Stromal
)
marker.genes.df <- subset(features.ids, symbols %in% marker.genes)
rownames(marker.genes.df) <- marker.genes.df$symbols
marker.genes.df <- marker.genes.df[marker.genes, ]
DotPlot(seu.GSE250130, assay = "RNA", features = marker.genes.df$ensg, group.by = "cell_type",
dot.scale = 5, cluster.idents = FALSE) +
labs(title = "", x = "", y = "") +
theme_classic(base_size = 13) +
theme(plot.title = element_text(hjust = 0.5, size = 14),
legend.title = element_text(size = 13),
legend.text = element_text(size = 13),
axis.text.x = element_text(angle = 45, hjust = 1, size = 13),
axis.text.y = element_text(size = 13),
legend.position = 'right', # bottom
# legend.box = "", # horizontal
legend.margin = margin()) +
scale_x_discrete(labels = marker.genes) +
scale_y_discrete(limits = rev(levels(as.factor(seu.GSE250130$cell_type)))) +
scale_color_distiller(type = "seq", direction = 1, palette = "Greys")
DotPlot(seu.GSE250130, assay = "RNA", features = marker.genes.df$ensg, group.by = "seurat_cluster",
dot.scale = 5, cluster.idents = FALSE) +
labs(title = "", x = "", y = "") +
theme_classic(base_size = 13) +
theme(plot.title = element_text(hjust = 0.5, size = 14),
legend.title = element_text(size = 13),
legend.text = element_text(size = 13),
axis.text.x = element_text(angle = 45, hjust = 1, size = 13),
axis.text.y = element_text(size = 13),
legend.position = 'right', # bottom
# legend.box = "", # horizontal
legend.margin = margin()) +
scale_x_discrete(labels = marker.genes) +
scale_y_discrete(limits = rev(levels(as.factor(seu.GSE250130$cell_type)))) +
scale_color_distiller(type = "seq", direction = 1, palette = "Greys")
seu.GSE250130 <- FindClusters(seu.GSE250130, resolution = 0.2)
DimPlot(seu.GSE250130, reduction = "umap.harmony", group.by = "seurat_clusters", label = TRUE)
DotPlot(seu.GSE250130, assay = "RNA", features = marker.genes.df$ensg, group.by = "seurat_clusters",
dot.scale = 5, cluster.idents = FALSE) +
labs(title = "", x = "", y = "") +
theme_classic(base_size = 13) +
theme(plot.title = element_text(hjust = 0.5, size = 14),
legend.title = element_text(size = 13),
legend.text = element_text(size = 13),
axis.text.x = element_text(angle = 45, hjust = 1, size = 13),
axis.text.y = element_text(size = 13),
legend.position = 'right', # bottom
# legend.box = "", # horizontal
legend.margin = margin()) +
scale_x_discrete(labels = marker.genes) +
scale_y_discrete(limits = rev(levels(as.factor(seu.GSE250130$cell_type)))) +
scale_color_distiller(type = "seq", direction = 1, palette = "Greys")
DotPlot(seu.GSE250130, assay = "RNA", features = marker.genes.df$ensg, group.by = "seurat_clusters",
dot.scale = 5, cluster.idents = FALSE) +
labs(title = "", x = "", y = "") +
theme_classic(base_size = 13) +
theme(plot.title = element_text(hjust = 0.5, size = 14),
legend.title = element_text(size = 13),
legend.text = element_text(size = 13),
axis.text.x = element_text(angle = 45, hjust = 1, size = 13),
axis.text.y = element_text(size = 13),
legend.position = 'right', # bottom
# legend.box = "", # horizontal
legend.margin = margin()) +
scale_x_discrete(labels = marker.genes)
View(marker.genes.df)
FeaturePlot(seu.GSE250130, feature = subset(features.ids, symbols %in% c('VWF'))$ensg)
seu.GSE250130 <- FindClusters(seu.GSE250130, resolution = 0.4)
DimPlot(seu.GSE250130, reduction = "umap.harmony", group.by = "seurat_clusters", label = TRUE)
seu.GSE250130 <- FindClusters(seu.GSE250130, resolution = 0.1)
DimPlot(seu.GSE250130, reduction = "umap.harmony", group.by = "seurat_clusters", label = TRUE)
seu.GSE250130 <- FindClusters(seu.GSE250130, resolution = 0.05)
DimPlot(seu.GSE250130, reduction = "umap.harmony", group.by = "seurat_clusters", label = TRUE)
FeaturePlot(seu.GSE250130, feature = subset(features.ids, symbols %in% c('MKI67'))$ensg)
seu.GSE250130 <- FindClusters(seu.GSE250130, resolution = 0.02)
DimPlot(seu.GSE250130, reduction = "umap.harmony", group.by = "seurat_clusters", label = TRUE)
cells.order.random <- sample(Cells(seu.GSE250130))
DimPlot(seu.GSE250130, reduction = "umap.harmony", group.by = "Phenotype",
label = FALSE, raster = FALSE, cells = cells.order.random) +
labs(title = '', x = 'UMAP Harmony 2', y = 'UMAP Harmony 1', color = 'Phenotype') +
theme_classic(base_size = 13) +
theme(plot.title = element_text(hjust = 0.5, size = 14),
legend.title = element_text(size = 13),
legend.text = element_text(size = 13),
axis.text.x = element_text(size = 13),
axis.text.y = element_text(size = 13),
legend.position = 'right') +
scale_colour_brewer(palette = 'Set2')
seu.GSE250130
head(Embeddings(seu.GSE250130, reduction = 'umap.harmony'))
seu.GSE250130$U1 <- Embeddings(seu.GSE250130, reduction = 'umap.harmony')$umapharmony_1 # bad practice but ok here
seu.GSE250130$U1 <- as.data.frame(Embeddings(seu.GSE250130, reduction = 'umap.harmony'))$umapharmony_1 # bad practice but ok here
seu.GSE250130$U2 <- as.data.frame(Embeddings(seu.GSE250130, reduction = 'umap.harmony'))$umapharmony_2
DimPlot(seu.GSE250130, reduction = "umap.harmony", group.by = "seurat_clusters", label = TRUE)
seu.GSE250130@meta.data <- seu.GSE250130@meta.data %>% mutate(cell_type = case_when(
seurat_clusters %in% c('3') ~ 'Myeloid',
seurat_clusters %in% c('0') & U1 < 0 & U2 < 5 ~ 'Lymphoid',
seurat_clusters %in% c('5') ~ 'Endothelial',
U2 > 7 ~ 'Epithelial',
seurat_clusters %in% c('0', '1') & U1 > 0 ~ 'Stromal'
))
DimPlot(seu.GSE250130, reduction = "umap.harmony", group.by = "cell_type",
label = FALSE, raster = FALSE, cells = cells.order.random, pt.size = 0.8) +
labs(title = '', x = 'UMAP Harmony 2', y = 'UMAP Harmony 1', color = 'Cell type') +
theme_classic(base_size = 13) +
theme(plot.title = element_text(hjust = 0.5, size = 14),
legend.title = element_text(size = 13),
legend.text = element_text(size = 13),
axis.text.x = element_text(size = 13),
axis.text.y = element_text(size = 13),
legend.position = 'right')
DimPlot(seu.GSE250130, reduction = "umap.harmony", group.by = "cell_type",
label = FALSE, raster = FALSE, cells = cells.order.random) +
labs(title = '', x = 'UMAP Harmony 2', y = 'UMAP Harmony 1', color = 'Cell type') +
theme_classic(base_size = 13) +
theme(plot.title = element_text(hjust = 0.5, size = 14),
legend.title = element_text(size = 13),
legend.text = element_text(size = 13),
axis.text.x = element_text(size = 13),
axis.text.y = element_text(size = 13),
legend.position = 'right')
# Generate pseudobulks and annotate samples using EndEst
seu.PRJNA1141235.fig4 <- readRDS('processed.data/seu.PRJNA1141235.fig4.Rds')
seu.GSE183837 <- readRDS('processed.data/seu.GSE183837.Rds')
